<%- responsavel ||= nil -%>
<%- title ||= 'Detalhes' -%>
<div class="row">
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-6">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">
          <%= title + ' - ' + (manutencao_servico.data_servico ? l(manutencao_servico.data_servico) : l(manutencao_servico.created_at) ) %>
        </h3>
      </div>
      <div class="panel-body">
        <% if manutencao_servico.horas_trabalhadas.present? %>
          <p><strong>Horas de servico:</strong> <%= manutencao_servico.horas_trabalhadas %>&nbsp;horas</p>
        <% end %>
        <p><strong>TIPO:</strong> <%= get_tipo_manutencao_servico(manutencao_servico.tipo) %></p>
        <div>
          <p><strong>Funcionários</strong></p>
          <ul>
            <%- if responsavel -%><li><%= responsavel %></li><%- end -%>
            <% manutencao_servico.manutencao_funcionarios.each do |subitem| %>
              <li><%= subitem.funcionario.try(:pessoa).try(:nome) %></li>
            <% end %>
          </ul>
        </div>
        <div>
          <%- if manutencao_servico.well_acess.present? || manutencao_servico.well_data.present? -%>
            <div class="row">
              <%- if manutencao_servico.well_acess.present? -%>
                <div class="col-xs-12 col-lg-6">
                  <p>
                    <strong>Acesso ao poço: </strong>
                    <%= manutencao_servico.well_acess %>
                  </p>
                </div>
              <%- end -%>
              <%- manutencao_servico.well_data.keys.each do |well_data_key| -%>
                <div class="col-xs-12 col-lg-6">
                  <p>
                    <strong><%= ManutencaoServico.label_for_well_data( well_data_key ) %></strong>
                    <%= manutencao_servico.well_data[well_data_key] %>
                  </p>
                </div>
              <%- end -%>
            </div>
          <%- end -%>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-3">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Produtos utilizados</h3>
      </div>
      <div class="panel-body">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Produto</th>
              <th>Qtd</th>
            </tr>
          </thead>
          <tbody>
            <%- if manutencao_servico.manutencao_servico_itens.size == 0 -%>
              <tr><td colspan="2">Nenhum produto foi utilizado</td></tr>
            <%- end -%>
            <% manutencao_servico.manutencao_servico_itens.each do |subitem| %>
              <tr>
                <td><%= subitem.produto.try(:descricao) %></td>
                <td><%= subitem.quantidade %></td>
              </tr>
            <% end %>
            <%- if manutencao_servico.well_data.present? && manutencao_servico.well_data['produtosNaoListados'].present? -%>
              <tr>
                <td colspan="2">
                  <strong>Outros Produtos</strong>
                  <p><%= manutencao_servico.well_data['produtosNaoListados'] %></p>
                </td>
              </tr>
            <%- end -%>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-4 col-lg-3">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Serviços realizados</h3>
      </div>
      <div class="panel-body">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Serviço</th>
            </tr>
          </thead>
          <tbody>
            <% manutencao_servico.service_items.each do |subitem| %>
              <tr>
                <td><%= subitem['name'] %></td>
              </tr>
            <% end %>
            <%- if manutencao_servico.descricao.present? -%>
              <tr><td>
                <p><%= manutencao_servico.descricao.html_safe %></p>
              </td></tr>
            <%- end -%>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
