<!-- Scaffolding generated by Casein v5.1.1.1 -->

<h2><%= @casein_page_title %></h2>

<%= form_for @orcamento, :url => casein_orcamento_path(@orcamento) do |f| %>

	<%= render :partial => 'casein/orcamentos/form', :locals => { :f => f } %>
	
	<div class="row">
		<div class="col-lg-6">
			<%= casein_date_select f, f.object, :data_proposta, casein_label: "Data da Proposta" %>
		</div>
		<div class="col-lg-3">
			<%= casein_text_field f, f.object, :validade_proposta, casein_label: "Validade da Proposta" %>
		</div>
		<div class="col-lg-3">
			<%= casein_text_field f, f.object, :prazo_execucao, casein_label: "Prazo de Execução" %>
		</div>
	</div>

	<div class="row">
		<div class="col-lg-6">
			<%= casein_text_field f, f.object, :cidade_data, casein_label: "Local e Data" %>
		</div>
		<div class="col-lg-3">
			<%= casein_text_field f, f.object, :prazo_inicio, casein_label: "Prazo de Início" %>
		</div>
		<div class="col-lg-3">
			<%= casein_text_field f, f.object, :condicao_pagamento, casein_label: "Condição de Pagamento" %>
		</div>
	</div>

	<div class="row">
		<div class="col-lg-12">
			<%= casein_text_field f, f.object, :descricao, casein_label: "Descrição" %>
		</div>
	</div>
	<p class="submits">
		<%= f.submit "Salvar", :class => "btn btn-mini btn-primary" %>
	</p>
<% end %>


<div class="row">
	<div class="col-lg-12">
		<h2>Adicionar Produto/Serviço</h2>
		<div class="row">	
			<div class="col-lg-2">
				<div class="form-group">
					<%= label_tag(:quantidade, "Quantidade:") %>
					<%= text_field_tag(:quantidade, params[:quantidade], class: "form-control", required: true) %>
				</div>
			</div>
			<div class="col-lg-2">
				<div class="form-group">
					<%= label_tag(:unidade, "Unidade:") %>
					<%= text_field_tag(:unidade, params[:unidade], class: "form-control", required: true) %>
				</div>
			</div>
			<div class="col-lg-6">
				<div class="form-group">
					<%= label_tag(:descricao, "Discriminação:") %>
					<%= text_field_tag(:descricao, params[:descricao], class: "form-control", required: true) %>
				</div>
			</div>
			<div class="col-lg-2">
				<div class="form-group">
					<%= label_tag(:preco_unitario, "Preço Unitário:") %>
					<%= text_field_tag(:preco_unitario, params[:preco_unitario], class: "form-control", required: true) %>
				</div>
			</div>
			<div class="col-lg-2">
				<div class="form-group">
					<br>
					<button type="button" class="btn btn-success" id="botao-cadastrar-produto">Adicionar</button>
				</div>
			</div>
			<div class="col-lg-1">
				<i class="fa fa-spinner fa-pulse loading" style="display:none;"></i>
			</div>
		</div>
	</div>
</div>

<div class="tabela">
	<%= render :partial => 'casein/orcamento_itens/table', :locals => { :orcamento_itens => @orcamento.orcamento_itens } %>
</div>

<%= link_to "Visualizar Orçamento", casein_orcamento_imprimir_path(@orcamento), target: "_blank", :class => "btn btn-mini btn-primary pull-left" %>
<%= link_to "Imprimir PDF", casein_orcamento_imprimir_path(@orcamento, :format => :pdf), target: "_blank", :class => "btn btn-mini btn-primary pull-left" %>


<%= content_for :sidebar do %>
	<%= render "sidebar_search" %>
<% end %>

<script charset="utf-8">

$('#quantidade').inputmask({ "mask": "9", "repeat": 10, "greedy": false });
$("#preco_unitario").inputmask("decimal", { radixPoint: ",", digits: 2, autoGroup: true, groupSeparator: ".", groupSize: 3 });

	jQuery(document).ready(function($) {
		$("#botao-cadastrar-produto").click(function(event) {
			var preco_unitario = $("#preco_unitario").val();
			var descricao = $("#descricao").val();
			var quantidade = $("#quantidade").val();
			var unidade = $("#unidade").val();
			$(".loading").show();

			$.ajax({
				url: '<%= casein_orcamento_iten_cadastro_ajax_path(1) %>',
				type: 'GET',
				dataType: 'script',
				data: {
					preco_unitario: preco_unitario,
					descricao: descricao,
					quantidade: quantidade,
					unidade: unidade,
					orcamento_id: <%= @orcamento.id %>
				}
			})
			.done(function() {
				$(".loading").show();
			})
			.fail(function() {

			})
			.always(function() {
				$(".loading").hide();
			});
		});
	});

</script>
