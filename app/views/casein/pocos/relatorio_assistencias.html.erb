<!-- Scaffolding generated by Casein v5.1.0.0 -->

<div id="printableArea">
  <h2>
    Relatório de Assistências
    <%= link_to("<i class='fa fa-search'></i> Personalizar Filtro".html_safe, "#modal-filtrar", "data-toggle" => "modal", class: "pull-right") %>
  </h2>

  <table class="table table-striped table-bordered" cellspacing="0" width="100%">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Linha</th>
        <th>Poço</th>
        <th>Cidade</th>
        <th>Processo</th>
        <th data-orderable="false" style="min-width: 80px;">&nbsp;</th>
      </tr>
    </thead>

    <tbody>
      <% @pocos.each do |poco| %>
        <tr>
          <td>
            <%- if poco.cliente.pessoa -%>
              <%= link_to("<i class='fa fa-user'></i> #{poco.nome_poco}".html_safe, casein_pessoa_path(poco.cliente.pessoa), target: :_blank) %>
            <%- else -%>
              Não definido
            <%- end -%>
          </td>
          <td><%= poco.linha_endereco %></td>
          <td><%= poco.apelido_endereco %></td>
          <td><%= poco.cidade.try(:get_nome_completo) %></td>
          <td><%= poco.numero_processo %></td>
          <td>
            <%= link_to(casein_show_row_icon("print"), casein_poco_filtro_relatorio_path(:format => :pdf, id: poco.id), class: "icon-table pull-left", target: "_blank") %>
            <%= link_to casein_show_row_icon("zoom-in"), casein_poco_relatorio_detalhes_path(id: poco.id, poco_id: poco.id), :class => "icon-table pull-left" %>
            <% fotos = poco.arquivos.all %>
            <% unless fotos.blank? %>
              <% fotos.each_with_index do |foto, i| %>
                <%= link_to casein_show_row_icon("picture"), foto.upload.url, data: {lightbox: "galeria-de-fotos-#{poco.id}"}, class: "icon-table pull-left #{'hidden' if i > 0}" %>
              <% end %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%= will_paginate @pocos, previous_label: "Anterior", next_label: "Próxima" %>

<div class="modal fade" id="modal-filtrar">
  <div class="modal-dialog">
    <div class="modal-content">
      <%= form_tag(casein_poco_relatorio_assistencias_path, method: :get, role: :form) do %>
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">Filtros do Relatório</h4>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-xs-12">
              <div class="form-group">
                <%= label_tag :numero_processo, "Processo" %>
                <%= text_field_tag(:numero_processo, params[:numero_processo], class: "form-control") %>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <%= submit_tag "Filtrar", class: "btn btn-primary" %>
        </div>
      <% end -%>
    </div>
  </div>
</div>