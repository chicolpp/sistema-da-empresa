<!-- Scaffolding generated by Casein v5.1.0.0 -->

<h2>
	Visualizar Ordem de Serviço
	<%= link_to "#{casein_show_icon "th-list"}Listar Ordem de Serviços".html_safe, casein_ordem_servicos_path, class: "pull-right" %>
	<%= link_to "#{casein_show_icon "edit"}Editar".html_safe, edit_casein_ordem_servico_path(@ordem_servico), class: "pull-right" %>
</h2>

<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
		<div class="panel panel-default">
		  <div class="panel-heading">
				<h3 class="panel-title">Dados Básicos</h3>
		  </div>
			<div class="panel-body">
				<p><strong>Número:</strong> <%= @ordem_servico.id %></p>
				<p><strong>Status:</strong> <%= @ordem_servico.status %></p>
				<% if @ordem_servico.abertura.present? %>
					<p><strong>Abertura:</strong> <%= l @ordem_servico.abertura %></p>
				<% end %>
				<p><strong>Cliente:</strong> <%= @ordem_servico.poco.cliente.pessoa.nome %></p>
				<p><strong>Funcionário:</strong> <%= @ordem_servico.funcionario.pessoa.nome %></p>
				<p><strong>Observações:</strong> <%= @ordem_servico.observacoes %></p>
				<p><strong>Sintoma:</strong> <%= @ordem_servico.sintoma %></p>
			</div>
		</div>
	</div>
</div>

<% @manutencaos.each do |manutencao| %>

<div>
	<h2>
		Visualizar Manutenção
		<%= link_to "#{casein_show_icon "th-list"}Listar Manutenções".html_safe, casein_manutencaos_path, class: "pull-right" if can? :index, Manutencao %>
		<%= link_to "#{casein_show_icon "edit"}Editar".html_safe, edit_casein_manutencao_path(manutencao), class: "pull-right" if can? :edit, Manutencao %>
	</h2>

	<div class="row">
		<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
			<div class="panel panel-default">
					<div class="panel-heading">
					<h3 class="panel-title">Dados Técnicos</h3>
					</div>
				<div class="panel-body">
					<p><strong>Código do Poço:</strong> <%= manutencao.poco_id %></p>
					<p><strong>Poço:</strong> <%= manutencao.poco.try(:nome_intuitivo) %></p>
					<p><strong>Número do Processo:</strong> <%= manutencao.numero_processo %></p>
					<p><strong>Serviço:</strong> <%= manutencao.servico.try(:descricao) %></p>
					<p><strong>Pessoa:</strong> <%= manutencao.pessoa_contato %></p>
					<p><strong>Telefone:</strong> <%= manutencao.telefone %></p>
					<p><strong>E-mail:</strong> <%= manutencao.email %></p>
				</div>
			</div>
		</div>

		<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
			<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Documentos/Arquivos</h3>
				<div align="right">
					<td><a data-toggle="modal" data-target="#manutencao-<%=manutencao.id%>">Adicionar Arquivo</a></td>
				</div>
			</div>
				<div class="panel-body">
					<% manutencao.arquivos.each_with_index do |item, i| %>
						<p>
							<% if item.upload_content_type.to_s == "image/png" || item.upload_content_type.to_s == "image/jpeg" || item.upload_content_type.to_s == "image/jpg" %>
								<%= link_to item.nome.present? ? item.nome : item.upload_file_name, item.upload.url, data: {lightbox: "galeria-de-fotos-#{item.album.present? ? item.album.to_s : i}"}, class: "icon-table pull-left" %>
							<% else %>
								<%= link_to item.nome.present? ? item.nome : item.upload_file_name, item.upload.url, target: :_blank %>
							<% end %>
							<% if item.comentarios.present? && item.comentarios != "\"\"" %>
								<strong>Comentários:</strong> <%= item.comentarios %>
							<% end %>
							&nbsp;
						</p>
					<% end %>

					<% if manutencao.arquivos.blank? %>
						<p>Não existem arquivos ou documentos para este registro.</p>
					<% end %>
				</div>
			</div>
		</div>

		<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			<div class="panel panel-default">
					<div class="panel-heading">
					<h3 class="panel-title">Equipamentos Utilizados</h3>
					</div>
				<div id="equipamentos-utilizados" class="panel-body">
					<% if @instalacao.try(:instalacao_poco_equipamentos) %>
						<%= render "casein/instalacao_poco_equipamentos/table" %>
					<% end %>
				</div>
			</div>
		</div>

		<div class="col-xs-12">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">Manutenção - Serviços Realizados</h3>
				</div>
				<div class="panel-body">
					<table class="table table-striped table-hover">
						<thead>
							<tr>
								<th>Tipo</th>
								<th>Descrição</th>
								<th>Data</th>
							</tr>
						</thead>
						<tbody>
							<% manutencao.manutencao_servicos.each do |item| %>
							<div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
							<div class="panel panel-default">
								<div class="panel-heading">
									<h3 class="panel-title"><%= manutencao.servico.descricao + ' - ' + l(item.data_servico) unless item.data_servico.blank? %></h3>
								</div>
								<div class="panel-body">
								<% if item.horas_trabalhadas.present? %>
									<p><strong>Horas de servico:</strong> <%= item.horas_trabalhadas %></p>
								<% end %>

									<p><%= item.descricao.html_safe if item.descricao.html_safe %></p>
					
									</div>
								</div>
							</div>

								<tr>
									<td colspan="4">
										<div class="row">
											<div class="col-xs-12 col-sm-6">
												<div class="row">
													<div class="col-xs-10">
														<b>Produto Utilizado</b>
													</div>
													<div class="col-xs-2">
														<b>Qtd</b>
													</div>
												</div>
												<hr style="margin-top:5px;margin-bottom:5px;">
												<% item.manutencao_servico_itens.each do |subitem| %>
													<div class="row">
														<div class="col-xs-10">
															<%= subitem.produto.try(:descricao) %>
														</div>
														<div class="col-xs-2">
															<%= subitem.quantidade %>
														</div>
													</div>
												<% end %>
											</div>
											<div class="col-xs-12 col-sm-6">
												<div class="row">
													<div class="col-xs-12">
														<b>Funcionário</b>
													</div>
												</div>
												<hr style="margin-top:5px;margin-bottom:5px;">
												<% item.manutencao_funcionarios.each do |subitem| %>
													<div class="row">
														<div class="col-xs-12">
															<%= subitem.funcionario.try(:pessoa).try(:nome) %>
														</div>
													</div>
												<% end %>
											</div>
										</div>
									</td>
								</tr>
							<% end %>
						</tbody>
					</table>
				</div>
			</div>
		</div>


		<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title">Serviços Necessários</h3>
				</div>
				<div class="panel-body">
					<% manutencao.manutencao_checklists.each_with_index do |item, i| %>
						<div class="col-xs-12 col-sm-12 col-md-2 col-lg-2">
							<div class="panel panel-default">
								<div class="panel-heading">
									<h3 class="panel-title"><%= item.nome %></h3>
								</div>
								<div class="panel-body">
									<p><%= item.descricao.html_safe if item.descricao.present? %></p>
									<% if item.observacoes.present? %>
										<p><strong>Observação:</strong> <%= item.observacoes %></p>
									<% end %>
					
								</div>
							</div>
						</div>
					<% end %>

					<% if manutencao.manutencao_checklists.blank? %>
						<p>Não existem Serviços Necessários para este registro.</p>
					<% end %>
				</div>
			</div>
		</div>
		
		<div class="modal fade" id="manutencao-<%=manutencao.id%>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content" style="margin-left: -20%;width: 140%;">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel"><%= manutencao.id %></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <%= form_for '', url: casein_new_arquivo_show_path, remote: true, multipart: true do |f| %>
            <%= hidden_field_tag :id, manutencao.id %>
            <div class="row">
              <div class="col-lg-6">
                <div class="input-group">
                  <span class="input-group-addon" id="addon-upload">Arquivo</span>
                  <%= f.file_field :upload, class: "form-control", "aria-describedby" => "addon-upload" %>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="input-group">
                  <span class="input-group-addon" id="addon-upload">Nome</span>
                  <%= f.text_field :nome, class: "form-control", "aria-describedby" => "addon-upload" %>
                </div>
              </div>
            </div>
            <div class="row" style="margin-top: 30px">
              <% manutencao.arquivos.each_with_index do |item, i| %>
                <% if item.upload_content_type.to_s != "image/png" && item.upload_content_type.to_s != "image/jpeg" && item.upload_content_type.to_s != "image/jpg" %>
                  <div class="col-lg-2">
                    <div class="input-group">
                      <span style="border: 1px solid #cccccc !important;" class="input-group-addon" id="addon-upload"><%= link_to item.nome.present? ? item.nome : item.upload_file_name, item.upload.url, target: :_blank %></span>
                    </div>
                  </div>
                <% end %>
              <% end %>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
              <button type="submit" class="btn btn-primary">Enviar</button>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
	</div>

</div>
<% end %>
