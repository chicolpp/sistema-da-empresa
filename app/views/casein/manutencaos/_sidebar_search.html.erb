<legend>Filtros</legend>

<div class="form-group">
	<%= label_tag :codigo, "Codigo do Poço" %>
	<%= text_field_tag :codigo, params[:codigo], class: "form-control", autofocus: true %>
</div>
<div class="form-group">
	<%= label_tag :descricao_servico, "Descrição do Serviço", class: "control-label" %>
	<%= text_field_tag :descricao_servico, params[:descricao_servico], class: "form-control", autofocus: true %>
</div>


<button type="button" id="botao-filtrar" class="btn btn-primary" data-toggle="modal" data-target="#filtro">
  Filtrar
</button>

<!-- Modal -->
<div class="modal fade" id="filtro" tabindex="-1" role="dialog" aria-labelledby="filtroLabel">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="filtroLabel">Filtro de Manutenção</h4>
      </div>
      <div class="modal-body">
      	<div class="tabela">
	      	<% @manutencaos = Manutencao.all %>
		      <%= render partial: "table", locals: { manutencaos: @manutencaos } %>
				</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
	$('#estado_id').change(function(){
    $.ajax({
      url: '<%= carregar_cidades_path %>',
      data: {
        estado_id: $(this).val(),
        target: $(this).data("target")
      }
    });
  });


  jQuery(document).ready(function($) {
		$("#botao-filtrar").click(function(event) {
			var descricao_servico = $("#descricao_servico").val();
			var codigo = $("#codigo").val();
			$(".loading").show();

			$.ajax({
				url: '<%= casein_manutencao_filtro_ajax_path(1) %>',
				type: 'GET',
				dataType: 'script',
				data: {
					descricao_servico: descricao_servico,
					codigo: codigo,
				}
			})
			.done(function() {
				$(".loading").show();
			})
			.fail(function() {

			})
			.always(function() {
				$(".loading").hide();
			});
		});
	});
</script>