<div class="panel panel-info">
  <div class="panel-body">
    Gerar Relatórios por Clientes
  </div>
  <div class="panel-footer">
		<%= form_tag(casein_cliente_filtro_relatorio_path, method: :get, role: :form, id: "cliente") do %>
			<legend>Filtros</legend>

			<div class="form-group">
				<%= label_tag :nome, "Nome", class: "control-label" %>
				<%= text_field_tag :nome, params[:nome], class: "form-control", autofocus: true %>
			</div>
			<div class="form-group">
				<%= label_tag :tipo, "Tipo de Pessoa", class: "control-label" %>
				<%= select_tag :tipo, options_for_select([["Física", 0], ["Jurídica", 1]], params[:tipo]), include_blank: "Mostrar Todos", class: "form-control" %>
			</div>
			<div class="form-group">
				<%= label_tag :estado_id, "Estado" %>
				<%= select_tag(:estado_id, options_from_collection_for_select(Estado.all, 'id', 'nome', params[:estado_id]), {:include_blank => "Selecione o Estado", :class => "form-control", data: {target: ".cidade_id"}}) %>
			</div>
			<div class="form-group">
				<%= label_tag :cidade_id, "Cidade" %>
				<%= select_tag(:cidade_id, options_from_collection_for_select(Cidade.where(estado_id: params[:estado_id]).all, 'id', 'nome', params[:cidade_id]), {:include_blank => "Selecione a Cidade", :class => "form-control cidade_id"}) %>
			</div>
			<%= submit_tag "Filtrar", class: "btn btn-primary" %>
		<% end -%>
  </div>
</div>


<table class="table table-striped table-hover table-condensed">
	<thead>
		<tr>
			<th>Nome</th>
		</tr>
	</thead>
	<% unless @clientes.blank? %>
		<% @clientes.each do |cliente| %>
			<tr>
				<td><%= cliente.pessoa.try(:nome) %></td>
			</tr>
		<% end %>
	<% end %>
</table>

<% unless @clientes.blank? %>
	<%= link_to "Imprimir PDF", "javascript:;", data: {url: casein_cliente_filtro_relatorio_path(:format => :pdf), form: "#cliente", target: "_blank"}, :class => "btn btn-mini btn-primary pull-left form_change_url" %>
<% end %>

<script type="text/javascript">
	$('#estado_id').change(function(){
    $.ajax({
      url: '<%= carregar_cidades_path %>',
      data: {
        estado_id: $(this).val(),
        target: $(this).data("target")
      }
    });
  });
</script>